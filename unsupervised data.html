<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">UDA - Unsupervised Data Augmentation | Shaun Spinelli</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shaunspinelli.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://shaunspinelli.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://shaunspinelli.github.io/unsupervised data"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="UDA - Unsupervised Data Augmentation | Shaun Spinelli"><meta data-rh="true" name="description" content="I look into a paper that introduces a fresh perspective on the role of advanced data augmentation methods in semi-supervised learning, showcasing remarkable results across various language and vision tasks. I show the key findings and dive into code examples that highlight the power of these techniques"><meta data-rh="true" property="og:description" content="I look into a paper that introduces a fresh perspective on the role of advanced data augmentation methods in semi-supervised learning, showcasing remarkable results across various language and vision tasks. I show the key findings and dive into code examples that highlight the power of these techniques"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2019-08-20T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="papers,deeplearning"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shaunspinelli.github.io/unsupervised data"><link data-rh="true" rel="alternate" href="https://shaunspinelli.github.io/unsupervised data" hreflang="en"><link data-rh="true" rel="alternate" href="https://shaunspinelli.github.io/unsupervised data" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Shaun Spinelli RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Shaun Spinelli Atom Feed"><link rel="stylesheet" href="/assets/css/styles.19b7e1c8.css">
<link rel="preload" href="/assets/js/runtime~main.4bbc3651.js" as="script">
<link rel="preload" href="/assets/js/main.f38ce385.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shaun Spinelli</b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/shaun-spinelli-824357114" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shaunspinelli" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/iwild cam 2019">IWild Cam 2019</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/unsupervised data">UDA - Unsupervised Data Augmentation</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">UDA - Unsupervised Data Augmentation</h1><div class="container_mt6G margin-vert--md"><time datetime="2019-08-20T00:00:00.000Z" itemprop="datePublished">August 20, 2019</time> · <!-- -->5 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>I look into a paper that introduces a fresh perspective on the role of advanced data augmentation methods in semi-supervised learning, showcasing remarkable results across various language and vision tasks. I show the key findings and dive into code examples that highlight the power of these techniques</p><p><a href="https://arxiv.org/abs/1904.12848" target="_blank" rel="noopener noreferrer">[Paper]</a> <a href="https://ai.googleblog.com/2019/07/advancing-semi-supervised-learning-with.html" target="_blank" rel="noopener noreferrer">[Blog Post]</a></p><p>All code snippets taken from this <a href="https://github.com/google-research/uda" target="_blank" rel="noopener noreferrer">repository</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-ideas-and-findings">Key Ideas and Findings<a href="#key-ideas-and-findings" class="hash-link" aria-label="Direct link to Key Ideas and Findings" title="Direct link to Key Ideas and Findings">​</a></h3><ul><li><p>Improving classification models with unlabeled data, data augmentation and semi-supervised learning. </p></li><li><p>Combining both labelled and unlabeled and using a custom loss function you can train a classifier for both computer vision and nlp problems.</p></li><li><p>Matches and outperforms supervised learning approaches with only a fraction of the data. </p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-results">Key Results<a href="#key-results" class="hash-link" aria-label="Direct link to Key Results" title="Direct link to Key Results">​</a></h3><p>1 - Using CIFAR-10 with 4k examples, UDA achieves an error rate of 5.27, matching the performance of a fully supervised model that uses 50k examples</p><p>2 - UDA achieves a new state-of-the-art error rate with a more than 45% reduction in error rate compared to the previous best semi-supervised result.</p><p>3 - On SVHN, UDA achieves an error rate of 2.46 with only 1k labeled examples, matching the performance of the fully supervised model trained with ~70k labeled examples.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Direct link to Components" title="Direct link to Components">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loss-function">Loss Function<a href="#loss-function" class="hash-link" aria-label="Direct link to Loss Function" title="Direct link to Loss Function">​</a></h3><p>This loss function is calculated by combining two loss functions one for the supervised part of the data (labelled) and one for the unsupervised part of the data (UDA). There is also a weighting factor <strong>λ</strong> applied to the UDA loss function, researchers set <strong>λ</strong> to 1 for most of their experiments.</p><p><strong>Supervised Loss (Labelled Data)-</strong>  Cross entropy</p><p><strong>Unsupervised Consistency Loss (Unlabelled Data)-</strong> more specifically KL divergence, it is calculated between predicted distributions on the unlabeled examples and unlabeled augmented example.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-of-kl-divergence">Implementation of KL-divergence<a href="#implementation-of-kl-divergence" class="hash-link" aria-label="Direct link to Implementation of KL-divergence" title="Direct link to Implementation of KL-divergence">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">uda/image/main.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># q_logits are the augmented logits </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_kl_divergence_with_logits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p_logits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q_logits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">softmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p_logits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_softmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p_logits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_q </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_softmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">q_logits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reduce_sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_p </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> log_q</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> kl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="loss function" src="/assets/images/4-Figure1-1-bc83060a7524b291a4127fd3157f0543.png" width="986" height="400" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="augmentation-strategies">Augmentation Strategies<a href="#augmentation-strategies" class="hash-link" aria-label="Direct link to Augmentation Strategies" title="Direct link to Augmentation Strategies">​</a></h2><p>Image augmentation was done using  <strong>AutoAugment</strong> <a href="https://ai.googleblog.com/2018/06/improving-deep-learning-performance.html" target="_blank" rel="noopener noreferrer">[Paper]</a> <a href="https://towardsdatascience.com/how-to-improve-your-image-classifier-with-googles-autoaugment-77643f0be0c9" target="_blank" rel="noopener noreferrer">[Medium]</a> and <strong>Cutout</strong> <a href="https://arxiv.org/abs/1708.04552" target="_blank" rel="noopener noreferrer">[Paper]</a> was also used for experiments with CIFAR-10 and SVHN. It is noted that there is a trade off between having diverse augmented training examples and at the same time keeping the ground truth label matched. Many augmented samples where created for one ground truth and were all generated offline before training.</p><p>Text augmentation was done using back translation and a process called TF-IDF.</p><p><img loading="lazy" alt="UDA Data augmentation" src="/assets/images/UDA-augmentation-d194301c61c4f56a297127d37fe37abb.png" width="907" height="376" class="img_ev3q"></p><p><strong>Results from ablation study on different augmentation strategies</strong></p><p><img loading="lazy" alt="augmentation results" src="/assets/images/aug-results-f3a15f822c4d3adfff775d7dad6020ce.png" width="487" height="288" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-training-techniques">Additional Training Techniques<a href="#additional-training-techniques" class="hash-link" aria-label="Direct link to Additional Training Techniques" title="Direct link to Additional Training Techniques">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="training-signal-annealing">Training Signal Annealing<a href="#training-signal-annealing" class="hash-link" aria-label="Direct link to Training Signal Annealing" title="Direct link to Training Signal Annealing">​</a></h3><p>By training on sch a small number of training samples there was a risk of the model overfitting to the labelled data. To negate that researches used (TSA) with the idea being to <em>gradually release training signals of the labeled data without overfitting as the model is trained on more and more unlabeled examples.</em></p><p>When the probability of the correct category is higher the some threshold then that example is removed from the loss calculation. This threshold prevents the model from over-training on examples it is already confident on.</p><p>Three threshold schedules were suggested with the decision on which to use dependant on the different ratios of labeled and unlabeled data.</p><p><strong>log-schedule</strong> where threshold is increased most rapidly at the beginning of training. Used when the model is <strong>less</strong> likely to overfit because of abundance of labeled examples or effective regularizations in the model.</p><p><strong>exp-schedule</strong> where threshold is increased most rapidly at the end of training. Used when the problem is <strong>more</strong> likely to overfit because of a relatively easy problem or the number of training examples is limited. The supervising signal get mostly released by the end of training.</p><p><strong>linear-schedule</strong> where the threshold is linearly increased while training.</p><p><img loading="lazy" alt="training signal schedules" src="/assets/images/5-Figure2-1-03f74b2cdc9f1037b5e679c30d5ae154.png" width="542" height="378" class="img_ev3q"></p><p><strong>Results from ablation study on different TSA schedules</strong></p><p><img loading="lazy" alt="training signal results" src="/assets/images/tsa-results-ee88fe7effa7e1d853626ff82ae1ed36.png" width="483" height="254" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-of-tsa">Implementation of TSA<a href="#implementation-of-tsa" class="hash-link" aria-label="Direct link to Implementation of TSA" title="Direct link to Implementation of TSA">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">uda/image/main.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_tsa_threshold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">schedule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> global_step</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num_train_steps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  step_ratio </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">global_step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_train_steps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> schedule </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;linear_schedule&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    coeff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> step_ratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> schedule </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exp_schedule&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scale </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [exp(-5), exp(0)] = [1e-2, 1]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    coeff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">step_ratio </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> scale</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> schedule </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;log_schedule&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scale </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [1 - exp(0), 1 - exp(-5)] = [0, 0.99]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    coeff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">step_ratio</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> scale</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> coeff </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Usage </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># line 258</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> eff_train_prob_threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_tsa_threshold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      FLAGS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tsa</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> global_step</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FLAGS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train_steps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tsa_start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> end</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># line 276</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> larger_than_threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">greater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      correct_label_probs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eff_train_prob_threshold</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sharpening-predictions">Sharpening Predictions<a href="#sharpening-predictions" class="hash-link" aria-label="Direct link to Sharpening Predictions" title="Direct link to Sharpening Predictions">​</a></h3><ul><li><strong>Confidence-based masking</strong> - If the predictions on the labelled data is below some confidence threshold then these predictions are removed from the final loss calculation, leaving only predictions with the highest confidence probabilities.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">uda/image/main.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ori_prob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">softmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ori_logits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">largest_prob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reduce_max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ori_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loss_mask </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">greater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">largest_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FLAGS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uda_confidence_thresh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># metric_dict[&quot;unsup/high_prob_ratio&quot;] = tf.reduce_mean(loss_mask)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loss_mask </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stop_gradient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loss_mask</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aug_loss </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aug_loss </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> loss_mask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># metric_dict[&quot;unsup/high_prob_loss&quot;] = tf.reduce_mean(aug_loss)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><strong>Entropy minimization</strong></p></li><li><p><strong>Softmax temperature controlling</strong></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="domain-relevance-data-filtering">Domain-relevance Data filtering<a href="#domain-relevance-data-filtering" class="hash-link" aria-label="Direct link to Domain-relevance Data filtering" title="Direct link to Domain-relevance Data filtering">​</a></h3><p>If the class distribution between the labeled and unlabeled data sets are unmatched it can hurt the performance of the model. To try and match the class distributions between the labeled and unlabeled data a model was trained on the labeled samples and used to infer the unlabeled samples class. Examples that the model was most confident on where then used for training.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="comparison-to-current-approaches">Comparison to current approaches<a href="#comparison-to-current-approaches" class="hash-link" aria-label="Direct link to Comparison to current approaches" title="Direct link to Comparison to current approaches">​</a></h3><p><img loading="lazy" alt="compare other apporaches" src="/assets/images/compare-results-50b86f6e7b80606b6bc6e0e41eab5f47.png" width="640" height="309" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/papers">papers</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/deeplearning">deeplearning</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/UDA/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/iwild cam 2019"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">IWild Cam 2019</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-ideas-and-findings" class="table-of-contents__link toc-highlight">Key Ideas and Findings</a></li><li><a href="#key-results" class="table-of-contents__link toc-highlight">Key Results</a></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#loss-function" class="table-of-contents__link toc-highlight">Loss Function</a></li><li><a href="#implementation-of-kl-divergence" class="table-of-contents__link toc-highlight">Implementation of KL-divergence</a></li></ul></li><li><a href="#augmentation-strategies" class="table-of-contents__link toc-highlight">Augmentation Strategies</a></li><li><a href="#additional-training-techniques" class="table-of-contents__link toc-highlight">Additional Training Techniques</a><ul><li><a href="#training-signal-annealing" class="table-of-contents__link toc-highlight">Training Signal Annealing</a></li><li><a href="#implementation-of-tsa" class="table-of-contents__link toc-highlight">Implementation of TSA</a></li><li><a href="#sharpening-predictions" class="table-of-contents__link toc-highlight">Sharpening Predictions</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li><li><a href="#domain-relevance-data-filtering" class="table-of-contents__link toc-highlight">Domain-relevance Data filtering</a></li><li><a href="#comparison-to-current-approaches" class="table-of-contents__link toc-highlight">Comparison to current approaches</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Shaun Spinelli. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4bbc3651.js"></script>
<script src="/assets/js/main.f38ce385.js"></script>
</body>
</html>